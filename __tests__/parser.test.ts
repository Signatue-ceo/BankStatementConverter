jest.mock('pdf-parse', () => jest.fn(() => Promise.resolve({ text: `

Customer service information
Customer service: 1.800.432.1000
En EspaÃ±ol: 1.800.688.6086 
bankofamerica.com
Bank of America, N.A.
P.O. Box 25118
Tampa, FL 33622-5118
Your Name 
Your Adress
P.O. Box 15284 
Wilmington, DE 19850
 PULL: B   CYCLE: 10   SPEC: E   DELIVERY: E   TYPE:    IMAGE: B   BC: FL
Page 1 of 5
Account number: 8981 1929 XXXX
Your Adv Plus Banking 
for April 01, 2016 to April 30, 2016
Your Name    
Account summary
Beginning balance on April 01, 2016
$48,993.43
Deposits and other additions
6,517.58
Withdrawals and other subtractions
-4,923.44
Checks-0.00
Service fees-0.00
Ending balance on April 30, 2016
$50,587.57 

Page 2 of 5
IMPORTANT INFORMATION:
BANK DEPOSIT ACCOUNTS
How to Contact Us - You may call us at the telephone number listed on the front of this statement.
Updating your contact information - We encourage you to keep your contact information up-to-date. This includes address,
email and phone number. If your information has changed, the easiest way to update it is by visiting the Help & Support tab of
Online Banking.
Deposit agreement - When you opened your account, you received a deposit agreement and fee schedule and agreed that your
account would be governed by the terms of these documents, as we may amend them from time to time. These documents are
part of the contract for your deposit account and govern all transactions relating to your account, including all deposits and
withdrawals. Copies of both the deposit agreement and fee schedule which contain the current version of the terms and
conditions of your account relationship may be obtained at our financial centers.
Electronic transfers: In case of errors or questions about your electronic transfers - If you think your statement or receipt is
wrong or you need more information about an electronic transfer (e.g., ATM transactions, direct deposits or withdrawals,
point-of-sale transactions) on the statement or receipt, telephone or write us at the address and number listed on the front of
this statement as soon as you can. We must hear from you no later than 60 days after we sent you the FIRST statement on
which the error or problem appeared.
-   Tell us your name and account number.
-   Describe the error or transfer you are unsure about, and explain as clearly as you can why you believe there is an error
or why you need more information.
-   Tell us the dollar amount of the suspected error.
For consumer accounts used primarily for personal, family or household purposes, we will investigate your complaint and will 
correct any error promptly. If we take more than 10 business days (10 calendar days if you are a Massachusetts customer (20 
business days if you are a new customer, for electronic transfers occurring during the first 30 days after the first deposit is 
made to your account to do this, we will provisionally credit your account for the amount you think is in error, so that you will 
have use of the money during the time it will take to complete our investigation.
For other accounts, we investigate, and if we find we have made an error, we credit your account at the conclusion of our 
investigation.
Reporting other problems - You must examine your statement carefully and promptly. You are in the best position to discover 
errors and unauthorized transactions on your account. If you fail to notify us in writing of suspected problems or an 
unauthorized transaction within the time period specified in the deposit agreement (which periods are no more than 60 days 
after we make the statement available to you and in some cases are 30 days or less, we are not liable to you and you agree to 
not make a claim against us, for the problems or unauthorized transactions.
Direct deposits - If you have arranged to have direct deposits made to your account at least once every 60 days from the same 
person or company, you may call us to find out if the deposit was made as scheduled. You may also review your activity online 
or visit a financial center for information.
 Â© 2016 Bank of America Corporation
Your Name  
!   Account # 4881 0142 XXXX  !    April 01, 2016 to April 30, 2016

Page 3 of 5
Deposits and other additions
DateDescription
Amount
04/07/IN
156.87
Cash App Transfer Conf# Qugtdt5ft; Sasha Sofee
Total deposits and other additions
$6,517.58
Withdrawals and other subtractions
DateDescriptionAmount
04/01/INPMNT SENT 0401 CASH APP*LECHE SI 4153753176 FL 561229501013855928936323-25.00
04/01/IN
BKOFAMERICA 04/01 IN BRANCH WITHDRWL TAMPA FL 
-400.00
04/02/INCHECKCARD 0401 Wawa 4329 TAMPA FL 5561436841014500087889161-28.69
04/02/IN
CHECKCARD 0401 Oceanic Oriental Supermarket 169 TAMPA FL 
563015000001259334 
-74.66
04/03/INBKOFAMERICA 04/03 IN BRANCH WITHDRWL TAMPA FL 
-970.00
04/03/INPMNT SENT 0402 CASH APP*LECHE SI 4153753176 FL 561829501014855458416596-25.49
04/04/INPURCHASE 0403 LYFT   *RIDE THU 8552800278 FL-8.99
04/05/INPMNT SENT 0404 CASH APP*LECHE SI 4153753176 FL 5562229501014855458456345-7.35
04/07/INZelle Transfer Conf# kwapx7s63; Shawen Markal
-37.49
04/08/IN
CHECKCARD 0407 City Bike Tampa 289 TAMPA FL 563015000001259334 
-26.00
04/08/IN
PMNT SENT 0407 CASH APP*HOUPETE 4153753176 FL 563229501016855398467587
-9.14
04/09/IN-3.53
04/10/INBKOFAMERICA 04/10 IN BRANCH WITHDRWL TAMPA FL 
-730.00
04/10/IN
-15.23
04/13/IN
-75.50
04/13/INPURCHASE 0412 LYFT   *RIDE FRI 8552800278 FL-3.12
04/17/INCHECKCARD  0417 The Home Depot 278 TAMPA FL 5548077102304676879885754
-8.71
continued on the next page
PURCHASE 0408 LYFT   *CANCEL FE 8552800278 FL
PMNT SENT 0412 CASH APP*HOUPETE 4153753176 FL 563829501016855398472442
PMNT SENT 0410 CASH APP*LECHE SI 4153753176 FL 563529501013855928936323
04/14/IN
 50.00 
ACH Direct Deposit There & Safe Logistics LLC, Ref#45250285
HLH1IN
 2,976.74 
Cash Deposit
04/10/IN
Zelle Transfer Conf# Wnkugku; Maria Loger
45.19
04/21/IN
 2,976.74 
ACH Direct Deposit There & Safe Logistics LLC, Ref#45250285
04/24/IN
185.22 
Zelle Transfer Conf# Yyftdtfuui; MACK
04/28/IN
 70.00 
Cash Deposit
04/30/IN
56.82 
Zelle Transfer Conf# Rftftf8f5; Marry Fariy
Your Name  
!   Account # 4881 0142 XXXX  !    April 01, 2016 to April 30, 2016

Page 4 of 5
Withdrawals and other subtractions - continued
DateDescriptionAmount
Total withdrawals and other subtractions
-$4,923.44
Service fees
Your Overdraft and NSF: Returned Item fees for this statement period and year to date are shown below.
Total for this periodTotal year-to-date
Total Overdraft fees$0.00$0.00
Total NSF: Returned Item fees$0.00
$0.00
We want to help you avoid overdraft and returned item fees.  Here are a few ways to manage your account and stay on top
of your balance: 
-  Set up Overdraft Protection in Online Banking to avoid declined transactions and save on overdraft fees
-  Sign up for Alerts (footnote 1) to get an email or text message when your balance becomes low
Please call us or visit us if you have any questions or to discuss your options.
(footnote 1) You may elect to receive alerts via text or email. Bank of America does not charge for this service but your mobile carrier's
message and data rates may apply. Delivery of alerts may be affected or delayed by your mobile carrier's coverage.
04/21/INKEEP THE CHANGE TRANSFER TO ACCT 7629 FOR 04/21/IN
-3.50
04/JJINZelle Transfer Conf# pwckh07m Morgan Milliar 
-10.00
04/24/INBKOFAMERICA 04/24 IN BRANCH WITHDRWL TAMPA FL 
-2300.00
04/26/INKEEP THE CHANGE TRANSFER TO ACCT 7629 FOR 04/26/IN
-3.94
04/26/INCHECKCARD 0425 LYFT  *RIDE WED 8558659553 FL 56500361021400969877903-7.26
04/28/INCHECKCARD 0427 LYFT  *RIDE WED 8558659553 FL 56550361022400971241915
-8.77
04/28/INKEEP THE CHANGE TRANSFER TO ACCT 7629 FOR 04/28/IN
-40.87
04/29/INZelle Transfer Conf# rvgttyf8sd; Arishi Pamils
-14.34
04/29/IN
CHECKCARD 0428 Publix Super Market at Channel Club TAMPA FL 56561361023400973424658
-7.43
04/30/INCHECKCARD 0429 Walmart Neighborhood Market 1601 TAMPA FL 56581771023026482420525-20.52
Your Name  
!   Account # 
4881 0142 XXXX   !    April 01, 2016 to April 30, 2016
04/17/IN-28.82
04/20/INPMNT SENT 0419 CASH APP*HOUPETE 4153753176 FL 564229501016855389745612
-13.00
04/20/INPURCHASE 0419 LYFT   *RIDE SAT 8552800278 TAMPA FL -5.34
04/21/INPURCHASE 0420 El Rancho Grocery Store 2445 TAMPA FL 564329501016855389745612 -10.75
CHECKCARD 0416 West Fortune Street Fish Market TAMPA FL 563015000001259334 

This page intentionally left blank
Page 5 of 5
Your Name  
!  Account # 4881 0142 XXXX  !    April 01, 2016 to April 30, 2016` })));

import * as fs from 'fs';
import * as parser from '../utils/parser';

describe('parseBankStatement', () => {
  let parseBoATextSpy: jest.SpyInstance;

  beforeEach(() => {
    // Spy on the actual parseBoAText function
    parseBoATextSpy = jest.spyOn(parser, 'parseBoAText');
    // Clear mock calls before each test
    parseBoATextSpy.mockClear();
  });

  afterEach(() => {
    // Restore the original implementation after each test
    parseBoATextSpy.mockRestore();
  });

  it('should parse a bank statement from a PDF file', async () => {
    // Mock the implementation for this specific test
    parseBoATextSpy.mockReturnValueOnce([{ date: '01/01', description: 'Test', amount: 100 }]);

    const fileBuffer = fs.readFileSync('test/data/Bank-of-America-sample-bank-statement.pdf');
    const fileType = 'application/pdf';
    const transactions = await parser.parseBankStatement(fileBuffer, fileType);
    expect(transactions).toBeDefined();
    expect(transactions.length).toBeGreaterThan(0);
  });

  it('should handle an unsupported file type', async () => {
    const fileBuffer = Buffer.from('test content');
    const fileType = 'text/plain';
    await expect(parser.parseBankStatement(fileBuffer, fileType)).rejects.toThrow('Unsupported file type');
  });

  it('should call the correct parser based on the bank', async () => {
    const fileBuffer = fs.readFileSync('test/data/Bank-of-America-sample-bank-statement.pdf');
    const fileType = 'application/pdf';

    await parser.parseBankStatement(fileBuffer, fileType, 'boa');
    expect(parseBoATextSpy).toHaveBeenCalled();
  });
});